import{e as m,c as p,b as l,w as F,F as k,a as e,r as b,o as v,d as g,k as q,l as B,j as f,m as _,p as j}from"./index--CBJS0Pd.js";import{a as I,s as w,b as L}from"./sweetalert-YiYa1UDA.js";const N=e("div",{class:"relative mb-3 h-[64px]"},[e("h2",{class:"absolute bottom-0 left-0 right-0 top-0 z-10 border-2 border-primary bg-white py-[18px] text-center text-xl font-bold"}," 張貼動態 "),e("div",{class:"absolute bottom-[-4px] left-[-4px] right-1 top-1 z-0 border-2 border-primary bg-white py-[18px] text-center text-xl font-bold"})],-1),S={class:"mb-4"},T=e("label",{for:"content",class:"mb-1 block"},[g(" 貼文內容 "),e("span",{class:"text-danger"},"*")],-1),z={class:"mb-4"},E=e("p",{class:"mb-1 mr-2"},[g(" 類型 "),e("span",{class:"text-danger"},"*")],-1),D={class:"mb-[2px] flex items-center gap-2"},M={for:"friend",class:"flex items-center gap-1"},O={for:"public",class:"flex items-center gap-1"},P={class:"mb-6"},A=e("label",{for:"tags",class:"mb-1 block"},"標籤（選填）",-1),G={class:"mr-2 flex select-none flex-wrap items-center gap-2"},H=e("span",{class:"material-symbols-outlined ml-2 select-none"},"tag",-1),J=["onClick"],K={key:0,class:"mt-1 flex items-center text-sm text-danger"},Q={class:"mb-4"},R={class:"mb-4"},W=e("button",{type:"button",class:"rounded bg-primary px-8 py-1 text-center text-white hover:bg-goldenrod hover:text-primary"}," 上傳圖片 ",-1),X=e("span",{class:"mx-3"},"或是",-1),Y={class:"mt-3 flex border-2 border-primary px-4 py-2"},Z={class:"relative"},ee=["src"],te=["disabled"],ae={__name:"CreatePost",setup(se){const u=m(!1),t=m({user:"6608ed1d2846fccc562fcde1",content:"",type:"",tags:[],image:""}),i=m(!1);function x(a){a==="open"?i.value=!0:t.value.image===""?i.value=!1:L({icon:"warning",title:"確定要刪除圖片嗎",text:"此操作將無法復原",onConfirm(){t.value.image="",i.value=!1}})}const h=m(null);async function C(){var a,s;u.value=!0;try{await I.post("https://node-training-2024.onrender.com/post ",t.value),h.value.resetForm(),w({icon:"success",title:"新增貼文成功"})}catch(c){w({icon:"error",title:((s=(a=c.response)==null?void 0:a.data)==null?void 0:s.message)??c.message??"發生錯誤"})}u.value=!1}async function $(){t.value.tags.push("");const a=t.value.tags.length-1;await j,document.querySelector(`#tag${a}`).focus()}return(a,s)=>{const c=b("VueLoading"),d=b("VField"),y=b("ErrorMessage"),U=b("VForm");return v(),p(k,null,[l(c,{active:u.value,"onUpdate:active":s[0]||(s[0]=r=>u.value=r)},null,8,["active"]),N,l(U,{ref_key:"form",ref:h,onSubmit:C,class:"border-2 border-primary bg-white p-8"},{default:F(r=>[e("div",S,[T,l(d,{id:"content",name:"貼文內容",placeholder:"輸入您的貼文內容",class:"min-h-[169px] w-full border-2 border-primary px-3 py-4",modelValue:t.value.content,"onUpdate:modelValue":s[1]||(s[1]=o=>t.value.content=o),style:{resize:"none"},rules:"required",as:"textarea"},null,8,["modelValue"]),l(y,{name:"貼文內容",class:"block text-sm text-danger"})]),e("div",z,[E,e("div",D,[e("label",M,[l(d,{name:"類型",rules:"required",id:"friend",type:"radio",value:"friend",modelValue:t.value.type,"onUpdate:modelValue":s[2]||(s[2]=o=>t.value.type=o)},null,8,["modelValue"]),g(" 好友 ")]),e("label",O,[l(d,{name:"類型",rules:"required",id:"public",type:"radio",value:"public",modelValue:t.value.type,"onUpdate:modelValue":s[3]||(s[3]=o=>t.value.type=o)},null,8,["modelValue"]),g(" 公開 ")])]),l(y,{name:"類型",class:"block text-sm text-danger"})]),e("div",P,[A,e("div",G,[(v(!0),p(k,null,q(t.value.tags,(o,n)=>(v(),p("div",{key:n,class:"relative flex max-w-fit items-center rounded border-2 border-primary"},[H,l(d,{rules:"required",type:"text",id:`tag${n}`,name:`標籤 ${n}`,modelValue:t.value.tags[n],"onUpdate:modelValue":V=>t.value.tags[n]=V,value:o,placeholder:"標籤內容",class:"w-[100px] py-1 pl-1 pr-3"},null,8,["id","name","modelValue","onUpdate:modelValue","value"]),e("button",{type:"button",class:"material-symbols-outlined absolute right-1 ml-1",onClick:V=>t.value.tags.splice(n,1)}," close ",8,J)]))),128)),e("button",{type:"button",class:"material-symbols-outlined h-8 w-8 rounded-full bg-primary p-1 text-base text-white hover:bg-goldenrod hover:text-primary",onClick:s[4]||(s[4]=o=>$())}," add ")]),r.errors&&Object.keys(r.errors).find(o=>/標籤/i.test(o))?(v(),p("p",K," 標籤欄位不得為空 ")):B("",!0)]),e("div",Q,[e("div",R,[W,X,e("button",{type:"button",class:"border-b-2 border-primary hover:border-secondary hover:text-secondary",onClick:s[5]||(s[5]=o=>x("open"))}," 輸入網址 "),f(e("div",Y,[l(d,{name:"圖片網址",rules:"url",modelValue:t.value.image,"onUpdate:modelValue":s[6]||(s[6]=o=>t.value.image=o),type:"text",placeholder:"請輸入圖片網址",class:"block w-full"},null,8,["modelValue"]),e("button",{type:"button",class:"material-symbols-outlined ml-1",onClick:s[7]||(s[7]=o=>x("close"))}," close ")],512),[[_,i.value]]),l(y,{name:"圖片網址",class:"mt-1 block text-sm text-danger"})]),f(e("div",Z,[e("img",{src:t.value.image,alt:"post-image",class:"mb-8 object-contain"},null,8,ee),f(e("button",{type:"button",class:"material-symbols-outlined absolute right-0 top-0 p-4",onClick:s[8]||(s[8]=o=>x("close"))}," close ",512),[[_,!i.value]])],512),[[_,t.value.image&&!r.errors.圖片網址]])]),e("button",{type:"submit",class:"mx-auto block rounded-lg border-2 border-primary bg-goldenrod px-[130px] py-4 disabled:bg-[#A8B0B9] disabled:text-primary",style:{"box-shadow":"-2px 2px 0px #000400"},disabled:Object.keys(r.errors).length!==0||t.value.content===""||t.value.type===""||t.value.tags.find(o=>o==="")}," 送出貼文 ",8,te)]),_:1},512)],64)}}};export{ae as default};

import{u as C,r as x,o as M,a as _,b as h,c as g,d as o,e,w as n,f as m,g as d,t as j,n as V,h as E,F as w,i as y,j as R,k as S}from"./index-DgaExn-t.js";import{u as k}from"./userStore-CGvQ59Sl.js";import{s as b}from"./sweetAlert-BQQMW04Z.js";const T={class:"fixed left-0 right-0 top-0 z-50 border-b-[3px] border-primary bg-white py-3"},z={class:"container flex items-center justify-between"},N={class:"font-Paytone-One text-[26px]"},U={id:"userMenu",class:"relative"},B=["src"],F={class:"border-b-2 border-primary font-bold",style:{"font-family":"'Azeret Mono', 'Noto Sans TC', sans"}},q={key:0,class:"fixed left-0 right-0 top-[66px] z-10 bg-white bg-opacity-75 py-2 text-center font-bold"},A={__name:"NavComponent",setup($){const c=C(),a=k(),p=x(!1);function t(){p.value=!p.value}M(()=>{document.querySelector("body").addEventListener("click",r=>{r.target.closest("#userMenu")||(p.value=!1)})});const f=x(!1);async function v(){var r,s;f.value=!0;try{await y.post("https://node-training-2024.onrender.com/user/sendVerificationMail"),b({icon:"success",title:"發送成功"})}catch(i){b({icon:"error",title:((s=(r=i.response)==null?void 0:r.data)==null?void 0:s.message)||i.message})}f.value=!1}const u=async()=>{document.cookie="MetaWallToken=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/",c.push("/sign/in"),b({icon:"success",title:"登出成功"})};return(r,s)=>{const i=_("VueLoading"),l=_("RouterLink");return h(),g(w,null,[o(i,{active:f.value,"onUpdate:active":s[0]||(s[0]=L=>f.value=L)},null,8,["active"]),e("nav",T,[e("div",z,[e("h1",N,[o(l,{to:"/"},{default:n(()=>[m("MetaWall")]),_:1})]),e("div",U,[e("button",{type:"button",class:"flex min-w-[182px] items-center justify-end",onClick:t},[e("img",{src:d(a).user.photo,alt:"大頭貼",class:"mr-[10px] h-[30px] w-[30px] rounded-full border-2 border-primary"},null,8,B),e("p",F,j(d(a).user.name),1)]),e("ul",{class:V(["absolute left-0 right-0 top-full z-10 mt-2 text-center transition-all after:absolute after:-bottom-2 after:-right-2 after:left-2 after:top-2 after:-z-10 after:border-2 after:border-primary after:bg-white",{"pointer-events-none opacity-0 ":!p.value}])},[e("li",null,[o(l,{to:`/user/${d(a).user.id}/posts`,onClick:t,class:"block w-full border-x-2 border-t-2 border-primary bg-white py-2 hover:bg-gray-100"},{default:n(()=>[m(" 我的貼文牆 ")]),_:1},8,["to"])]),e("li",null,[o(l,{to:"/user/edit",onClick:t,class:"block w-full border-x-2 border-t-2 border-primary bg-white py-2 hover:bg-gray-100"},{default:n(()=>[m(" 修改個人資料 ")]),_:1})]),e("li",null,[e("button",{type:"button",onClick:u,class:"w-full border-2 border-primary bg-white py-2 hover:bg-gray-100"}," 登出 ")])],2)])])]),d(a).user.isVerifiedEmail?E("",!0):(h(),g("p",q,[m(" 您目前尚未驗證信箱，僅能瀏覽貼文，請至信箱點擊驗證連結。沒有收到信嗎？ "),e("button",{type:"button",class:"text-secondary",onClick:v},"點我"),m(" 發送驗證信 ")])),e("div",{class:V(["h-[66px]",{"mb-[41px]":!d(a).user.isVerifiedEmail}])},null,2)],64)}}},D={class:"hidden w-[36%] lg:block"},W={class:"top-24 border-2 border-primary bg-white px-6 py-8 lg:sticky"},O=["src"],P={class:"font-bold"},G=e("div",{class:"flex h-[50px] w-[50px] items-center justify-center rounded-full border-2 border-primary bg-[#E2EDFA]"},[e("span",{class:"material-symbols-outlined"},"notifications")],-1),J=e("p",{class:"font-bold"},"追蹤名單",-1),H=e("div",{class:"flex h-[50px] w-[50px] items-center justify-center rounded-full border-2 border-primary bg-[#E2EDFA]"},[e("span",{class:"material-symbols-outlined"},"thumb_up")],-1),I=e("p",{class:"font-bold"},"我按讚的文章",-1),K={class:"fixed bottom-3 left-0 right-0 mx-2 lg:hidden"},Q={class:"container flex justify-center gap-6 rounded-[32px] border-[3px] border-primary bg-[#EFECE7] py-[6px]"},X=e("span",{class:"material-symbols-outlined font-medium text-primary"},"home",-1),Y=e("span",{class:"material-symbols-outlined font-medium text-primary"},"notifications",-1),Z=e("span",{class:"material-symbols-outlined font-medium text-primary"},"thumb_up",-1),ee=e("span",{class:"material-symbols-outlined font-medium text-white"},"add",-1),te={__name:"SecNavComponent",setup($){const c=k();return(a,p)=>{const t=_("RouterLink");return h(),g(w,null,[e("aside",D,[e("nav",W,[o(t,{to:"/post/create",class:"w-100 mb-6 flex items-center justify-center rounded-lg border-2 border-primary bg-secondary py-4 font-bold text-white hover:bg-goldenrod hover:text-primary",style:{"box-shadow":"-2px 2px 0px #000400"}},{default:n(()=>[m(" 張貼動態 ")]),_:1}),o(t,{to:`/user/${d(c).user.id}/posts`,class:"mb-4 flex w-full items-center gap-4 hover:text-secondary"},{default:n(()=>[e("img",{src:d(c).user.photo,alt:"user-photo",class:"h-[50px] w-[50px] rounded-full border-2 border-primary object-contain"},null,8,O),e("p",P,j(d(c).user.name),1)]),_:1},8,["to"]),o(t,{to:"/user/following",class:"aside-item mb-4 flex w-full items-center gap-4 hover:text-secondary"},{default:n(()=>[G,J]),_:1}),o(t,{to:"/user/likes",class:"aside-item flex w-full items-center gap-4 hover:text-secondary"},{default:n(()=>[H,I]),_:1})])]),e("nav",K,[e("div",Q,[o(t,{to:"/",class:"flex h-[48px] w-[48px] items-center justify-center rounded-full border-[3px] border-primary bg-white"},{default:n(()=>[X]),_:1}),o(t,{to:"/user/following",class:"flex h-[48px] w-[48px] items-center justify-center rounded-full border-[3px] border-primary bg-white"},{default:n(()=>[Y]),_:1}),o(t,{to:"/user/likes",class:"flex h-[48px] w-[48px] items-center justify-center rounded-full border-[3px] border-primary bg-white"},{default:n(()=>[Z]),_:1}),o(t,{to:"/post/create",class:"flex h-[48px] w-[48px] items-center justify-center rounded-full border-[3px] border-primary bg-secondary"},{default:n(()=>[ee]),_:1})])])],64)}}},se={class:"bg relative min-h-screen after:bg-[length:36px_36px] after:sm:bg-[length:64px_64px]"},oe={class:"container flex justify-between gap-7 py-12"},re={class:"w-full lg:w-[62%]"},le={__name:"UserView",setup($){const c=R(),a=C(),p=k(),t=x(!1),f=x(!1);async function v(){var u,r;try{const{token:s}=c.query;await y.post("https://node-training-2024.onrender.com/user/verifyMail",{token:s}),b({icon:"success",title:"驗證成功"}),a.push("/")}catch(s){b({icon:"error",title:((r=(u=s.response)==null?void 0:u.data)==null?void 0:r.message)||s.message})}}return M(async()=>{var s,i;const u=document.cookie.replace(/(?:(?:^|.*;\s*)MetaWallToken\s*=\s*([^;]*).*$)|^.*$/,"$1");u?y.defaults.headers.common.authorization=`Bearer ${u}`:a.push("/sign/in"),t.value=!0;const{token:r}=c.query;r&&v();try{await y.post("https://node-training-2024.onrender.com/user/check"),await p.getUserProfile(),f.value=!0}catch(l){if(l.response.status===429){b({icon:"error",title:((i=(s=l.response)==null?void 0:s.data)==null?void 0:i.message)||l.message});return}a.push("/sign/in")}t.value=!1}),(u,r)=>{const s=_("VueLoading"),i=_("RouterView");return h(),g(w,null,[o(s,{active:t.value,"onUpdate:active":r[0]||(r[0]=l=>t.value=l)},null,8,["active"]),e("div",se,[o(A),e("div",oe,[e("main",re,[f.value?(h(),S(i,{key:0})):E("",!0)]),o(te)])])],64)}}};export{le as default};

import{r as g,o as C,a as _,b as h,c as v,d as s,e,w as i,f,u as c,t as j,n as V,g as E,F as w,h as x,i as M,j as L,k as R}from"./index-DGkBJbzT.js";import{u as k}from"./userStore-2c8d9DMH.js";import{s as b}from"./sweetAlert-CCyWe-_C.js";const S={class:"fixed left-0 right-0 top-0 z-50 border-b-[3px] border-primary bg-white py-3"},z={class:"container flex items-center justify-between"},N={class:"font-Paytone-One text-[26px]"},U={id:"userMenu",class:"relative"},B=["src"],F={class:"border-b-2 border-primary font-bold",style:{"font-family":"'Azeret Mono', 'Noto Sans TC', sans"}},T={key:0,class:"fixed left-0 right-0 top-[66px] z-10 bg-white bg-opacity-75 py-2 text-center font-bold"},q={__name:"NavComponent",setup($){const r=k(),l=g(!1);function u(){l.value=!l.value}C(()=>{document.querySelector("body").addEventListener("click",d=>{d.target.closest("#userMenu")||(l.value=!1)})});const t=g(!1);async function y(){var d,a;t.value=!0;try{await x.post("http://127.0.0.1:3000/user/sendVerificationMail"),b({icon:"success",title:"發送成功"})}catch(n){b({icon:"error",title:((a=(d=n.response)==null?void 0:d.data)==null?void 0:a.message)||n.message})}t.value=!1}return(d,a)=>{const n=_("VueLoading"),o=_("RouterLink");return h(),v(w,null,[s(n,{active:t.value,"onUpdate:active":a[0]||(a[0]=p=>t.value=p)},null,8,["active"]),e("nav",S,[e("div",z,[e("h1",N,[s(o,{to:"/"},{default:i(()=>[f("MetaWall")]),_:1})]),e("div",U,[e("button",{type:"button",class:"flex min-w-[182px] items-center justify-end",onClick:u},[e("img",{src:c(r).user.photo,alt:"大頭貼",class:"mr-[10px] h-[30px] w-[30px] rounded-full border-2 border-primary"},null,8,B),e("p",F,j(c(r).user.name),1)]),e("ul",{class:V(["absolute left-0 right-0 top-full z-10 mt-2 text-center transition-all after:absolute after:-bottom-2 after:-right-2 after:left-2 after:top-2 after:-z-10 after:border-2 after:border-primary after:bg-white",{"pointer-events-none opacity-0 ":!l.value}])},[e("li",null,[s(o,{to:`/user/${c(r).user.id}/posts`,onClick:u,class:"block w-full border-x-2 border-t-2 border-primary bg-white py-2 hover:bg-gray-100"},{default:i(()=>[f(" 我的貼文牆 ")]),_:1},8,["to"])]),e("li",null,[s(o,{to:"/user/edit",onClick:u,class:"block w-full border-x-2 border-t-2 border-primary bg-white py-2 hover:bg-gray-100"},{default:i(()=>[f(" 修改個人資料 ")]),_:1})]),e("li",null,[e("button",{type:"button",onClick:u,class:"w-full border-2 border-primary bg-white py-2 hover:bg-gray-100"}," 登出 ")])],2)])])]),c(r).user.isVerifiedEmail?E("",!0):(h(),v("p",T,[f(" 您目前尚未驗證信箱，僅能瀏覽貼文，請至信箱點擊驗證連結。沒有收到信嗎？ "),e("button",{type:"button",class:"text-secondary",onClick:y},"點我"),f(" 發送驗證信 ")])),e("div",{class:V(["h-[66px]",{"mb-[41px]":!c(r).user.isVerifiedEmail}])},null,2)],64)}}},A={class:"hidden w-[36%] lg:block"},D={class:"top-24 border-2 border-primary bg-white px-6 py-8 lg:sticky"},O=["src"],P={class:"font-bold"},W=e("div",{class:"flex h-[50px] w-[50px] items-center justify-center rounded-full border-2 border-primary bg-[#E2EDFA]"},[e("span",{class:"material-symbols-outlined"},"notifications")],-1),G=e("p",{class:"font-bold"},"追蹤名單",-1),H=e("div",{class:"flex h-[50px] w-[50px] items-center justify-center rounded-full border-2 border-primary bg-[#E2EDFA]"},[e("span",{class:"material-symbols-outlined"},"thumb_up")],-1),I=e("p",{class:"font-bold"},"我按讚的文章",-1),J={class:"fixed bottom-3 left-0 right-0 mx-2 lg:hidden"},K={class:"container flex justify-center gap-6 rounded-[32px] border-[3px] border-primary bg-[#EFECE7] py-[6px]"},Q=e("span",{class:"material-symbols-outlined font-medium text-primary"},"home",-1),X=e("span",{class:"material-symbols-outlined font-medium text-primary"},"notifications",-1),Y=e("span",{class:"material-symbols-outlined font-medium text-primary"},"thumb_up",-1),Z=e("span",{class:"material-symbols-outlined font-medium text-white"},"add",-1),ee={__name:"SecNavComponent",setup($){const r=k();return(l,u)=>{const t=_("RouterLink");return h(),v(w,null,[e("aside",A,[e("nav",D,[s(t,{to:"/post/create",class:"w-100 mb-6 flex items-center justify-center rounded-lg border-2 border-primary bg-secondary py-4 font-bold text-white hover:bg-goldenrod hover:text-primary",style:{"box-shadow":"-2px 2px 0px #000400"}},{default:i(()=>[f(" 張貼動態 ")]),_:1}),s(t,{to:`/user/${c(r).user.id}/posts`,class:"mb-4 flex w-full items-center gap-4 hover:text-secondary"},{default:i(()=>[e("img",{src:c(r).user.photo,alt:"user-photo",class:"h-[50px] w-[50px] rounded-full border-2 border-primary object-contain"},null,8,O),e("p",P,j(c(r).user.name),1)]),_:1},8,["to"]),s(t,{to:"/user/following",class:"aside-item mb-4 flex w-full items-center gap-4 hover:text-secondary"},{default:i(()=>[W,G]),_:1}),s(t,{to:"/user/likes",class:"aside-item flex w-full items-center gap-4 hover:text-secondary"},{default:i(()=>[H,I]),_:1})])]),e("nav",J,[e("div",K,[s(t,{to:"/",class:"flex h-[48px] w-[48px] items-center justify-center rounded-full border-[3px] border-primary bg-white"},{default:i(()=>[Q]),_:1}),s(t,{to:"/user/following",class:"flex h-[48px] w-[48px] items-center justify-center rounded-full border-[3px] border-primary bg-white"},{default:i(()=>[X]),_:1}),s(t,{to:"/user/likes",class:"flex h-[48px] w-[48px] items-center justify-center rounded-full border-[3px] border-primary bg-white"},{default:i(()=>[Y]),_:1}),s(t,{to:"/post/create",class:"flex h-[48px] w-[48px] items-center justify-center rounded-full border-[3px] border-primary bg-secondary"},{default:i(()=>[Z]),_:1})])])],64)}}},te={class:"bg relative min-h-screen after:bg-[length:36px_36px] after:sm:bg-[length:64px_64px]"},se={class:"container flex justify-between gap-7 py-12"},oe={class:"w-full lg:w-[62%]"},ie={__name:"UserView",setup($){const r=M(),l=L(),u=k(),t=g(!1),y=g(!1);async function d(){var a,n;try{const{token:o}=r.query;await x.post("http://127.0.0.1:3000/user/verifyMail",{token:o}),b({icon:"success",title:"驗證成功"}),l.push("/")}catch(o){b({icon:"error",title:((n=(a=o.response)==null?void 0:a.data)==null?void 0:n.message)||o.message})}}return C(async()=>{var o,p;const a=document.cookie.replace(/(?:(?:^|.*;\s*)MetaWallToken\s*=\s*([^;]*).*$)|^.*$/,"$1");a?x.defaults.headers.common.authorization=`Bearer ${a}`:l.push("/sign/in"),t.value=!0;const{token:n}=r.query;n&&d();try{await x.post("http://127.0.0.1:3000/user/check"),await u.getUserProfile(),y.value=!0}catch(m){if(m.response.status===429){b({icon:"error",title:((p=(o=m.response)==null?void 0:o.data)==null?void 0:p.message)||m.message});return}l.push("/sign/in")}t.value=!1}),(a,n)=>{const o=_("VueLoading"),p=_("RouterView");return h(),v(w,null,[s(o,{active:t.value,"onUpdate:active":n[0]||(n[0]=m=>t.value=m)},null,8,["active"]),e("div",te,[s(q),e("div",se,[e("main",oe,[y.value?(h(),R(p,{key:0})):E("",!0)]),s(ee)])])],64)}}};export{ie as default};

import{r as x,o as z,m as H,b as l,c as d,d as e,p as A,t as $,u as r,n as f,q as K,v as R,f as E,j as U,k,F as S,s as q,i as j,x as Y,a as X,e as N,l as Z}from"./index-COQyUUYm.js";import{p as W,_ as O}from"./SpinnerComponent-CL-WYMfp.js";import{u as G}from"./userStore-CWTvoLgD.js";import{s as F,a as J}from"./sweetAlert-BQoRJUAf.js";const ee={class:"mb-4 flex flex-col gap-3 lg:flex-row"},te={id:"sortMenu",class:"border-2 border-primary bg-white"},se={class:"relative"},oe={class:"flex w-full select-none items-center border-2 border-primary bg-white"},ne=e("label",{for:"search",class:"hidden"},null,-1),le=e("span",{class:"material-symbols-outlined h-5 w-5"},"search",-1),re=[le],ae={__name:"PostSearchBar",setup(_){const s=W(),u=x(!1);function c(b){s.sort=b||s.sort,u.value=!u.value}const y=b=>{b.target.closest("#sortMenu")||(u.value=!1)};return z(()=>{document.querySelector("body").addEventListener("click",y)}),H(()=>{document.querySelector("body").removeEventListener("click",y)}),(b,o)=>(l(),d("div",ee,[e("div",te,[e("div",se,[e("div",{class:"flex cursor-pointer items-center justify-between px-4 py-3 lg:w-[156px]",onClick:o[0]||(o[0]=p=>c()),onKeyup:o[1]||(o[1]=A(p=>c(),["enter"]))},[e("p",null,$(r(s).sort==="asc"?"由舊至新":"最新貼文"),1),e("span",{class:f(["material-symbols-outlined select-none transition-all duration-300",u.value?"rotate-180":""])}," expand_more ",2)],32),e("ul",{class:f([{"pointer-events-none opacity-0 ":!u.value},"absolute left-0 right-0 top-14 z-10 bg-white outline outline-2 outline-primary transition-all"])},[e("li",{class:f(["px-4 py-3",r(s).sort==="desc"?"pointer-events-none bg-secondary text-white":"cursor-pointer hover:bg-gray-100"]),onClick:o[2]||(o[2]=p=>{c("desc"),r(s).getPosts()}),onKeyup:o[3]||(o[3]=A(p=>{c("desc"),r(s).getPosts()},["enter"]))}," 最新貼文 ",34),e("li",{class:f(["px-4 py-3",r(s).sort==="asc"?"pointer-events-none bg-secondary text-white":"cursor-pointer hover:bg-gray-100"]),onClick:o[4]||(o[4]=p=>{c("asc"),r(s).getPosts()}),onKeyup:o[5]||(o[5]=A(p=>{c("asc"),r(s).getPosts()},["enter"]))}," 由舊至新 ",34)],2)])]),e("div",oe,[ne,K(e("input",{id:"search",type:"text",placeholder:"搜尋貼文",class:"focus-visible: block h-full w-full px-4 py-3 outline-none","onUpdate:modelValue":o[6]||(o[6]=p=>r(s).keyword=p),onKeyup:o[7]||(o[7]=A((...p)=>r(s).getPosts&&r(s).getPosts(...p),["enter"]))},null,544),[[R,r(s).keyword,void 0,{trim:!0}]]),e("button",{type:"button",class:"flex aspect-square items-center justify-center border-l-2 border-primary bg-secondary p-[13px] text-xl text-white",onClick:o[8]||(o[8]=(...p)=>r(s).getPosts&&r(s).getPosts(...p))},re)])]))}};function T(_){const s=new Date(_),u=s.getFullYear(),c=s.getMonth()+1,y=s.getDate(),b=`0${s.getHours()}`.slice(-2),o=`0${s.getMinutes()}`.slice(-2);return`${u}/${c<10?`0${c}`:c}/${y<10?`0${y}`:y} ${b}:${o}`}var ie={VITE_API_URL:"https://node-training-2024.onrender.com",BASE_URL:"/node-training-2024-front/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const de={class:"mb-[18px] mt-5 flex"},ce=["src"],ue={class:"w-full border-2 border-primary px-4 py-1"},pe=["for"],me=["id"],ye=["disabled"],be={class:"flex w-full"},ve=["src"],_e={class:"w-full"},ge={class:"mb-1"},xe={type:"button",class:"self-start font-bold hover:text-secondary hover:underline hover:decoration-secondary hover:underline-offset-2"},fe={class:"text-[12px] text-[#9B9893]"},he=["title"],$e={key:0,class:"mt-2"},ke={for:"editCommentInput",class:"mb-2 block w-full border-2 border-primary px-2 py-1"},we={class:"flex items-center justify-end gap-2"},Ce=["onClick"],Pe={key:1},Se={key:0,id:"commentMenu",class:"relative self-start"},Ee=["onClick"],Le=["onClick"],Ie=e("span",{class:"material-symbols-outlined text-xl leading-none"},"edit",-1),Me=["onClick","disabled"],Be=e("span",{class:"material-symbols-outlined text-xl leading-none"},"delete",-1),Ae={__name:"PostComment",props:["post","postIndex"],setup(_){const s=_,u=G(),c=W(),{VITE_API_URL:y}=ie,b=x("");function o(n){b.value===n?b.value="":b.value=n}const p=x({}),w=x("");async function C(n){var a,h;w.value=n;try{const v={comment:p.value[n]};await j.post(`${y}/post/${n}/comment`,v),p.value[n]="",await c.getPosts()}catch(v){F({icon:"error",title:((h=(a=v.response)==null?void 0:a.data)==null?void 0:h.message)||v.message})}w.value=""}const L=x(""),P=x(""),m=x(""),g=x(!1);async function I(n,a){L.value=a,P.value=a,m.value=n,g.value=!0,await Y,document.querySelector("#editCommentInput").focus()}async function V(n){var a,h;if(w.value=n,L.value!==P.value)try{const v={comment:P.value};await j.patch(`${y}/post/comment/${n}`,v),await c.getPosts()}catch(v){F({icon:"error",title:((h=(a=v.response)==null?void 0:a.data)==null?void 0:h.message)||v.message})}w.value="",m.value="",g.value=!1}const t=x("");function D(n){J({icon:"warning",title:"確定要刪除留言嗎",text:"注意：此操作將無法復原",onConfirm:async()=>{var a,h;t.value=n;try{await j.delete(`${y}/post/comment/${n}`),await c.getPosts()}catch(v){F({icon:"error",title:((h=(a=v.response)==null?void 0:a.data)==null?void 0:h.message)||v.message})}t.value=""}})}const B=n=>{n.target.closest("#commentMenu")||(b.value="")};return z(()=>{document.querySelector("body").addEventListener("click",B)}),H(()=>{document.querySelector("body").removeEventListener("click",B)}),(n,a)=>{var h,v;return l(),d(S,null,[e("div",de,[e("img",{src:r(u).user.photo,alt:"大頭貼",class:"mr-2 h-[40px] w-[40px] rounded-full border-2 border-primary"},null,8,ce),e("div",ue,[e("label",{for:`commentInput-${s.postIndex}`},[K(e("input",{id:`commentInput-${s.postIndex}`,type:"text",class:"h-full w-full",placeholder:"留言...","onUpdate:modelValue":a[0]||(a[0]=i=>p.value[_.post._id]=i),onKeyup:a[1]||(a[1]=A(i=>C(_.post._id),["enter"]))},null,40,me),[[R,p.value[_.post._id]]])],8,pe)]),e("button",{type:"button",class:"flex min-w-24 items-center justify-center gap-2 border-2 border-l-0 border-primary bg-secondary text-white hover:bg-goldenrod hover:text-primary disabled:bg-gray-300 disabled:text-primary md:min-w-32",onClick:a[2]||(a[2]=i=>C(_.post._id)),disabled:!((h=p.value[_.post._id])!=null&&h.length)||!((v=p.value[_.post._id])!=null&&v.trim())||w.value===_.post._id},[E(" 留言 "),w.value===_.post._id?(l(),U(O,{key:0,width:"14px",height:"14px",color:"primary"})):k("",!0)],8,ye)]),s.post.comments.length>0?(l(!0),d(S,{key:0},q(s.post.comments,(i,Q)=>(l(),d("div",{key:i.id,class:f(["flex items-center rounded-xl bg-[#EFECE7] bg-opacity-30 px-4 py-[18px]",Q===s.post.comments.length-1?"mb-0":"mb-4"])},[e("div",be,[e("img",{src:i.user.photo,alt:"大頭貼",class:"mr-3 h-[40px] w-[40px] self-start rounded-full border-2 border-primary"},null,8,ve),e("div",_e,[e("div",ge,[e("button",xe,$(i.user.name),1),e("div",fe,[e("time",null,$(r(T)(i.createdAt)),1),i.updatedAt!==i.createdAt&&i.updatedAt?(l(),d("span",{key:0,title:r(T)(i.updatedAt)}," ( 已編輯 ) ",8,he)):k("",!0)])]),g.value&&i._id===m.value?(l(),d("div",$e,[e("label",ke,[K(e("input",{type:"text",id:"editCommentInput","onUpdate:modelValue":a[3]||(a[3]=M=>P.value=M)},null,512),[[R,P.value]])]),e("div",we,[e("button",{type:"button",onClick:a[4]||(a[4]=M=>{g.value=!1,m.value=""}),class:"border-2 border-primary bg-gray-50 px-4 py-1"}," 取消 "),e("button",{type:"button",onClick:M=>V(i._id),class:"flex items-center gap-2 border-2 border-primary bg-secondary px-4 py-1 text-white"},[E(" 確定 "),w.value===i._id?(l(),U(O,{key:0,width:"16px",height:"16px",color:"white"})):k("",!0)],8,Ce)])])):(l(),d("p",Pe,$(i.comment),1))])]),i.user._id===r(u).user.id?(l(),d("div",Se,[e("button",{type:"button",onClick:M=>o(i._id),class:f(["material-symbols-outlined text-primary opacity-70 hover:opacity-100",{"opacity-100":b.value===i._id}])}," more_horiz ",10,Ee),e("ul",{class:f(["absolute right-10 top-0 z-10 w-32 text-center transition-all after:absolute after:-bottom-2 after:-right-2 after:left-2 after:top-2 after:-z-10 after:border-2 after:border-primary after:bg-white",{"pointer-events-none opacity-0 ":b.value!==i._id}])},[e("li",null,[e("button",{type:"button",onClick:M=>{o(),I(i._id,i.comment)},class:"flex w-full items-center gap-2 border-x-2 border-t-2 border-primary bg-white px-3 py-2 hover:bg-gray-100"},[Ie,E(" 編輯 ")],8,Le)]),e("li",null,[e("button",{type:"button",onClick:M=>{o(),D(i._id)},class:"flex w-full items-center gap-2 border-2 border-primary bg-white px-3 py-2 hover:bg-gray-100",disabled:t.value===i._id},[Be,E(" 刪除 ")],8,Me)])],2)])):k("",!0)],2))),128)):k("",!0)],64)}}},Ve={class:"mb-3"},De={class:"relative bottom-0 mb-4 flex"},qe={class:"flex w-full gap-4"},ze=["src"],Ue={type:"button",class:"self-start font-bold hover:text-secondary hover:underline hover:decoration-secondary hover:underline-offset-2"},Te={class:"flex items-center"},je={class:"text-[12px] text-[#9B9893]"},Fe=["title"],Ke={class:"material-symbols-outlined ml-2 text-lg leading-none text-[#707070]"},Re={key:0,id:"postMenu",class:"self-start"},Ne=["onClick"],Oe=["onClick"],He=e("span",{class:"material-symbols-outlined text-xl leading-none"},"edit",-1),We=["onClick"],Ye=e("span",{class:"material-symbols-outlined text-xl leading-none"},"delete",-1),Ge={class:"mb-1"},Je={key:0,class:"flex flex-wrap items-center gap-1 text-sm text-secondary"},Qe=e("span",{class:"material-symbols-outlined select-none text-lg"},"tag",-1),Xe=["src"],Ze={class:"flex items-center gap-2"},et=["onClick","disabled"],tt=["onClick"],st=e("span",{class:"material-symbols-outlined mt-[2px] text-xl"},"chat",-1),ot={key:1,class:"rounded-lg border-2 border-primary bg-white",style:{"box-shadow":"0px 3px 0px #000400"}},nt={class:"flex items-center gap-[6px] border-b-2 border-primary p-4"},lt={class:"py-8"},rt={key:0,class:"text-center text-[#9B9893]"},at=e("p",{class:"mb-1 text-center text-[#9B9893]"},"查無相關貼文",-1),it=e("span",{class:"material-symbols-outlined"},"undo",-1),dt=e("span",{class:"mr-2"},"返回",-1),ct=[it,dt],ut={__name:"PostComponent",setup(_){const s=G(),u=W(),c=x(!1);z(async()=>{c.value=!0,await u.getPosts(),c.value=!1});const y=x("");async function b(m,g){y.value=g,await s.handleLikePost(m,g),u.getPosts(),y.value=""}const o=x({});async function p(m,g){o.value[m]=!o.value[m],await Y;const I=document.querySelector(`#commentInput-${g}`);I&&I.focus()}async function w(m){J({icon:"warning",title:"確定要刪除貼文嗎",text:"注意：此操作將無法復原",onConfirm:async()=>{c.value=!0,await u.deletePost(m),c.value=!1}})}const C=x("");function L(m){C.value===m?C.value="":C.value=m}const P=m=>{m.target.closest("#postMenu")||(C.value="")};return z(async()=>{document.querySelector("body").addEventListener("click",P)}),H(()=>{document.querySelector("body").removeEventListener("click",P)}),(m,g)=>{var V;const I=X("VueLoading");return l(),d(S,null,[N(I,{active:c.value,"onUpdate:active":g[0]||(g[0]=t=>c.value=t)},null,8,["active"]),(V=r(u).posts)!=null&&V.length?(l(!0),d(S,{key:0},q(r(u).posts,(t,D)=>{var B;return l(),d("div",{key:t._id,class:"mb-4 rounded-lg border-2 border-primary bg-white p-6",style:{"box-shadow":"0px 3px 0px #000400"}},[e("div",Ve,[e("div",De,[e("div",qe,[e("img",{src:t.user.photo,alt:"大頭貼",class:"h-[45px] w-[45px] rounded-full border-2 border-primary"},null,8,ze),e("div",null,[e("button",Ue,$((B=t.user)==null?void 0:B.name),1),e("div",Te,[e("div",je,[e("time",null,$(r(T)(t.createdAt)),1),t.updatedAt!==t.createdAt&&t.updatedAt?(l(),d("span",{key:0,class:"ml-1",title:r(T)(t.updatedAt)}," ( 已編輯 ) ",8,Fe)):k("",!0)]),e("span",Ke,$(t.type==="friend"?"group":"public"),1)])])]),r(s).user.id===t.user._id?(l(),d("div",Re,[e("button",{type:"button",onClick:n=>L(t._id),class:f(["material-symbols-outlined text-primary opacity-70 hover:opacity-100",{"opacity-100":C.value===t._id}])}," more_horiz ",10,Ne),e("ul",{class:f(["absolute right-0 top-8 z-10 w-32 text-center transition-all after:absolute after:-bottom-2 after:-right-2 after:left-2 after:top-2 after:-z-10 after:border-2 after:border-primary after:bg-white",{"pointer-events-none opacity-0 ":C.value!==t._id}])},[e("li",null,[e("button",{type:"button",onClick:n=>{L(),r(u).goToEditPost(t)},class:"flex w-full items-center gap-2 border-x-2 border-t-2 border-primary bg-white px-3 py-2 hover:bg-gray-100"},[He,E(" 編輯 ")],8,Oe)]),e("li",null,[e("button",{type:"button",onClick:n=>{L(),w(t._id)},class:"flex w-full items-center gap-2 border-2 border-primary bg-white px-3 py-2 hover:bg-gray-100"},[Ye,E(" 刪除 ")],8,We)])],2)])):k("",!0)]),e("p",Ge,$(t.content),1),t.tags.length?(l(),d("ul",Je,[(l(!0),d(S,null,q(t.tags,(n,a)=>(l(),d("li",{key:`${n}${a}`,class:"flex items-center"},[Qe,E(" "+$(n),1)]))),128))])):k("",!0),t.image?(l(),d("img",{key:1,src:t.image,alt:"貼文圖片",class:"mt-4 max-w-full rounded-lg border-2 border-primary object-contain"},null,8,Xe)):k("",!0)]),e("div",Ze,[e("button",{type:"button",onClick:n=>b(t.isLiked,t._id),disabled:y.value===t._id,class:f(["-ml-2 flex items-center gap-2 rounded-lg px-2 py-1 hover:bg-gray-100",t.likes?"text-secondary":"text-[#9B9893] hover:text-secondary"])},[e("span",{class:"material-symbols-outlined mt-[2px] text-xl",style:Z(t.isLiked?"font-variation-settings: 'FILL' 1;":"")}," thumb_up ",4),e("span",null,$(t.likes?t.likes:"成為第一個按讚的朋友"),1),y.value===t._id?(l(),U(O,{key:0,width:"16px",height:"16px",color:"secondary"})):k("",!0)],10,et),e("button",{type:"button",class:"flex items-center gap-2 rounded-lg px-2 py-1 hover:bg-gray-100",onClick:n=>p(t._id,D)},[st,e("span",null,$(t.comments.length),1),e("span",{class:f(["material-symbols-outlined select-none transition-all duration-300",{"rotate-180":o.value[t._id]}])}," expand_more ",2)],8,tt)]),o.value[t._id]?(l(),U(Ae,{key:0,post:t,postIndex:D},null,8,["post","postIndex"])):k("",!0)])}),128)):(l(),d("div",ot,[e("div",nt,[(l(),d(S,null,q(["#DE4B63","#FAA722","#83C51D"],t=>e("span",{key:t,class:f(["h-[10px] w-[10px] select-none rounded-full border border-[#707070]",`bg-[${t}]`])},null,2)),64))]),e("div",lt,[r(u).keyword===""?(l(),d("p",rt," 目前尚無動態，新增一則貼文吧！ ")):(l(),d(S,{key:1},[at,e("button",{type:"button",onClick:g[1]||(g[1]=t=>r(u).getPosts("all")),class:"mx-auto flex items-center gap-1 text-secondary hover:opacity-80"},ct)],64))])]))],64)}}},vt={__name:"PostWall",setup(_){return(s,u)=>(l(),d(S,null,[N(ae),N(ut)],64))}};export{vt as default};

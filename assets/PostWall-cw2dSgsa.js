import{u as se,r as h,o as N,l as Q,b as s,c as u,e,m as U,t as g,g as r,n as L,p as W,v as G,f as P,k as V,h as x,F as E,q as D,i as j,s as Z,j as ee,a as K,d as B,w as R,x as H,y as Y,z as ne}from"./index-DgaExn-t.js";import{p as z}from"./postStore-Bg-Fg6pW.js";import{u as X}from"./userStore-CGvQ59Sl.js";import{_ as J}from"./SpinnerComponent-C0OplAm1.js";import{f as O}from"./format-CRl3Pp5k.js";import{s as T,a as te}from"./sweetAlert-BQQMW04Z.js";const re={class:"mb-4 flex flex-col gap-3 lg:flex-row"},le={id:"sortMenu",class:"border-2 border-primary bg-white"},ae={class:"relative"},ie={class:"flex w-full select-none items-center border-2 border-primary bg-white"},de=e("label",{for:"search",class:"hidden"},null,-1),ue=e("span",{class:"material-symbols-outlined h-5 w-5"},"search",-1),ce=[ue],pe={__name:"PostSearchBar",setup(w){const n=se(),a=z(),l=h(!1);function y(c){a.sort=c||a.sort,l.value=!l.value}async function i(){n.push(`?q=${a.keyword}&sort=${a.sort}`)}const f=c=>{c.target.closest("#sortMenu")||(l.value=!1)};return N(()=>{document.querySelector("body").addEventListener("click",f)}),Q(()=>{document.querySelector("body").removeEventListener("click",f)}),(c,o)=>(s(),u("div",re,[e("div",le,[e("div",ae,[e("div",{class:"flex cursor-pointer items-center justify-between px-4 py-3 lg:w-[156px]",onClick:o[0]||(o[0]=b=>y()),onKeyup:o[1]||(o[1]=U(b=>y(),["enter"]))},[e("p",null,g(r(a).sort==="asc"?"由舊至新":"最新貼文"),1),e("span",{class:L(["material-symbols-outlined select-none transition-all duration-300",l.value?"rotate-180":""])}," expand_more ",2)],32),e("ul",{class:L([{"pointer-events-none opacity-0 ":!l.value},"absolute left-0 right-0 top-14 z-10 bg-white outline outline-2 outline-primary transition-all"])},[e("li",{class:L(["px-4 py-3",r(a).sort==="desc"?"pointer-events-none bg-secondary text-white":"cursor-pointer hover:bg-gray-100"]),onClick:o[2]||(o[2]=b=>{y("desc"),i()}),onKeyup:o[3]||(o[3]=U(b=>{y("desc"),i()},["enter"]))}," 最新貼文 ",34),e("li",{class:L(["px-4 py-3",r(a).sort==="asc"?"pointer-events-none bg-secondary text-white":"cursor-pointer hover:bg-gray-100"]),onClick:o[4]||(o[4]=b=>{y("asc"),i()}),onKeyup:o[5]||(o[5]=U(b=>{y("asc"),i()},["enter"]))}," 由舊至新 ",34)],2)])]),e("div",ie,[de,W(e("input",{id:"search",type:"text",placeholder:"搜尋貼文",class:"focus-visible: block h-full w-full px-4 py-3 outline-none","onUpdate:modelValue":o[6]||(o[6]=b=>r(a).keyword=b),onKeyup:U(i,["enter"])},null,544),[[G,r(a).keyword,void 0,{trim:!0}]]),e("button",{type:"button",class:"flex aspect-square items-center justify-center border-l-2 border-primary bg-secondary p-[13px] text-xl text-white",onClick:i},ce)])]))}};var me={VITE_API_URL:"https://node-training-2024.onrender.com",BASE_URL:"/node-training-2024-front/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const ye={class:"mb-[18px] mt-5 flex"},be=["src"],_e={class:"w-full border-2 border-primary px-4 py-1"},fe=["for"],ve=["id"],he=["disabled"],xe={class:"flex w-full"},ge=["src"],we={class:"w-full"},ke={class:"mb-1"},$e={type:"button",class:"self-start font-bold hover:text-secondary hover:underline hover:decoration-secondary hover:underline-offset-2"},Ce={class:"text-[12px] text-[#9B9893]"},Le=["title"],Se={key:0,class:"mt-2"},Pe={for:"editCommentInput",class:"mb-2 block w-full border-2 border-primary px-2 py-1"},Ee={class:"flex items-center justify-end gap-2"},Ie=["onClick"],qe={key:1},Be={key:0,id:"commentMenu",class:"relative self-start"},Ve=["onClick"],Ae=["onClick"],Me=e("span",{class:"material-symbols-outlined text-xl leading-none"},"edit",-1),Ue=["onClick","disabled"],ze=e("span",{class:"material-symbols-outlined text-xl leading-none"},"delete",-1),Fe={__name:"PostComment",props:["post","postIndex"],setup(w){const n=w,a=X(),l=z(),{VITE_API_URL:y}=me,i=h("");function f(t){i.value===t?i.value="":i.value=t}const c=h({}),o=h("");async function b(t){var d,m;o.value=t;try{const v={comment:c.value[t]};await j.post(`${y}/post/${t}/comment`,v),c.value[t]="",await l.getPosts()}catch(v){T({icon:"error",title:((m=(d=v.response)==null?void 0:d.data)==null?void 0:m.message)||v.message})}o.value=""}const k=h(""),$=h(""),S=h(""),_=h(!1);async function C(t,d){k.value=d,$.value=d,S.value=t,_.value=!0,await Z,document.querySelector("#editCommentInput").focus()}async function I(t){var d,m;if(o.value=t,k.value!==$.value)try{const v={comment:$.value};await j.patch(`${y}/post/comment/${t}`,v),await l.getPosts()}catch(v){T({icon:"error",title:((m=(d=v.response)==null?void 0:d.data)==null?void 0:m.message)||v.message})}o.value="",S.value="",_.value=!1}const q=h("");function F(t){te({icon:"warning",title:"確定要刪除留言嗎",text:"注意：此操作將無法復原",onConfirm:async()=>{var d,m;q.value=t;try{await j.delete(`${y}/post/comment/${t}`),await l.getPosts()}catch(v){T({icon:"error",title:((m=(d=v.response)==null?void 0:d.data)==null?void 0:m.message)||v.message})}q.value=""}})}const M=t=>{t.target.closest("#commentMenu")||(i.value="")};return N(()=>{document.querySelector("body").addEventListener("click",M)}),Q(()=>{document.querySelector("body").removeEventListener("click",M)}),(t,d)=>{var m,v;return s(),u(E,null,[e("div",ye,[e("img",{src:r(a).user.photo,alt:"大頭貼",class:"mr-2 h-[40px] w-[40px] rounded-full border-2 border-primary"},null,8,be),e("div",_e,[e("label",{for:`commentInput-${n.postIndex}`},[W(e("input",{id:`commentInput-${n.postIndex}`,type:"text",class:"h-full w-full",placeholder:"留言...","onUpdate:modelValue":d[0]||(d[0]=p=>c.value[w.post._id]=p),onKeyup:d[1]||(d[1]=U(p=>b(w.post._id),["enter"]))},null,40,ve),[[G,c.value[w.post._id]]])],8,fe)]),e("button",{type:"button",class:"flex min-w-24 items-center justify-center gap-2 border-2 border-l-0 border-primary bg-secondary text-white hover:bg-goldenrod hover:text-primary disabled:bg-gray-300 disabled:text-primary md:min-w-32",onClick:d[2]||(d[2]=p=>b(w.post._id)),disabled:!((m=c.value[w.post._id])!=null&&m.length)||!((v=c.value[w.post._id])!=null&&v.trim())||o.value===w.post._id},[P(" 留言 "),o.value===w.post._id?(s(),V(J,{key:0,width:"14px",height:"14px",color:"primary"})):x("",!0)],8,he)]),n.post.comments.length>0?(s(!0),u(E,{key:0},D(n.post.comments,(p,oe)=>(s(),u("div",{key:p.id,class:L(["flex items-center rounded-xl bg-[#EFECE7] bg-opacity-30 px-4 py-[18px]",oe===n.post.comments.length-1?"mb-0":"mb-4"])},[e("div",xe,[e("img",{src:p.user.photo,alt:"大頭貼",class:"mr-3 h-[40px] w-[40px] self-start rounded-full border-2 border-primary"},null,8,ge),e("div",we,[e("div",ke,[e("button",$e,g(p.user.name),1),e("div",Ce,[e("time",null,g(r(O)(p.createdAt)),1),p.updatedAt!==p.createdAt&&p.updatedAt?(s(),u("span",{key:0,title:r(O)(p.updatedAt)}," ( 已編輯 ) ",8,Le)):x("",!0)])]),_.value&&p._id===S.value?(s(),u("div",Se,[e("label",Pe,[W(e("input",{type:"text",id:"editCommentInput","onUpdate:modelValue":d[3]||(d[3]=A=>$.value=A)},null,512),[[G,$.value]])]),e("div",Ee,[e("button",{type:"button",onClick:d[4]||(d[4]=A=>{_.value=!1,S.value=""}),class:"border-2 border-primary bg-gray-50 px-4 py-1"}," 取消 "),e("button",{type:"button",onClick:A=>I(p._id),class:"flex items-center gap-2 border-2 border-primary bg-secondary px-4 py-1 text-white"},[P(" 確定 "),o.value===p._id?(s(),V(J,{key:0,width:"16px",height:"16px",color:"white"})):x("",!0)],8,Ie)])])):(s(),u("p",qe,g(p.comment),1))])]),p.user._id===r(a).user.id?(s(),u("div",Be,[e("button",{type:"button",onClick:A=>f(p._id),class:L(["material-symbols-outlined text-primary opacity-70 hover:opacity-100",{"opacity-100":i.value===p._id}])}," more_horiz ",10,Ve),e("ul",{class:L(["absolute right-10 top-0 z-10 w-32 text-center transition-all after:absolute after:-bottom-2 after:-right-2 after:left-2 after:top-2 after:-z-10 after:border-2 after:border-primary after:bg-white",{"pointer-events-none opacity-0 ":i.value!==p._id}])},[e("li",null,[e("button",{type:"button",onClick:A=>{f(),C(p._id,p.comment)},class:"flex w-full items-center gap-2 border-x-2 border-t-2 border-primary bg-white px-3 py-2 hover:bg-gray-100"},[Me,P(" 編輯 ")],8,Ae)]),e("li",null,[e("button",{type:"button",onClick:A=>{f(),F(p._id)},class:"flex w-full items-center gap-2 border-2 border-primary bg-white px-3 py-2 hover:bg-gray-100",disabled:q.value===p._id},[ze,P(" 刪除 ")],8,Ue)])],2)])):x("",!0)],2))),128)):x("",!0)],64)}}},Re={class:"mb-3"},De={class:"relative bottom-0 mb-4 flex"},je={class:"flex w-full gap-4"},Te=["src"],Ke={class:"flex items-center"},Oe={class:"text-[12px] text-[#9B9893]"},Ne=["title"],We={class:"material-symbols-outlined ml-2 text-lg leading-none text-[#707070]"},Ge={key:0,id:"postMenu",class:"self-start"},He=["onClick"],Je=["onClick"],Qe=e("span",{class:"material-symbols-outlined text-xl leading-none"},"edit",-1),Xe=["onClick"],Ye=e("span",{class:"material-symbols-outlined text-xl leading-none"},"delete",-1),Ze={class:"mb-1"},et={key:0,class:"flex flex-wrap items-center gap-1 text-sm text-secondary"},tt=e("span",{class:"material-symbols-outlined select-none text-lg"},"tag",-1),ot=["src"],st={class:"flex items-center gap-2"},nt=["onClick","disabled"],rt=["onClick"],lt=e("span",{class:"material-symbols-outlined mt-[2px] text-xl"},"chat",-1),at={key:1,class:"rounded-lg border-2 border-primary bg-white",style:{"box-shadow":"0px 3px 0px #000400"}},it={class:"flex items-center gap-[6px] border-b-2 border-primary p-4"},dt={class:"py-8"},ut={key:0,class:"text-center text-[#9B9893]"},ct=e("p",{class:"mb-1 text-center text-[#9B9893]"},"查無相關貼文",-1),pt={class:"flex"},mt=e("span",{class:"material-symbols-outlined"},"undo",-1),yt=e("span",{class:"mr-2"},"返回",-1),bt={key:2,class:"mb-4 flex justify-end"},_t=e("span",{class:"material-symbols-outlined text-xl leading-none"},"undo",-1),ft={__name:"PostComponent",setup(w){const n=ee(),a=X(),l=z(),y=h(!1),i=h("");async function f(_,C){i.value=C,await a.handleLikePost(_,C),l.getPosts(),i.value=""}const c=h({});async function o(_,C){c.value[_]=!c.value[_],await Z;const I=document.querySelector(`#commentInput-${C}`);I&&I.focus()}async function b(_){te({icon:"warning",title:"確定要刪除貼文嗎",text:"注意：此操作將無法復原",onConfirm:async()=>{y.value=!0,await l.deletePost(_),y.value=!1}})}const k=h("");function $(_){k.value===_?k.value="":k.value=_}const S=_=>{_.target.closest("#postMenu")||(k.value="")};return N(async()=>{document.querySelector("body").addEventListener("click",S)}),Q(()=>{document.querySelector("body").removeEventListener("click",S)}),(_,C)=>{var F,M;const I=K("VueLoading"),q=K("RouterLink");return s(),u(E,null,[B(I,{active:y.value,"onUpdate:active":C[0]||(C[0]=t=>y.value=t)},null,8,["active"]),(F=r(l).posts)!=null&&F.length?(s(!0),u(E,{key:0},D(r(l).posts,(t,d)=>(s(),u("div",{key:t._id,class:"mb-4 rounded-lg border-2 border-primary bg-white p-6",style:{"box-shadow":"0px 3px 0px #000400"}},[e("div",Re,[e("div",De,[e("div",je,[B(q,{to:`/user/${t.user._id}/posts`},{default:R(()=>[e("img",{src:t.user.photo,alt:"大頭貼",class:"h-[45px] w-[45px] rounded-full border-2 border-primary"},null,8,Te)]),_:2},1032,["to"]),e("div",null,[B(q,{to:`/user/${t.user._id}/posts`,class:"block self-start font-bold hover:text-secondary hover:underline hover:decoration-secondary hover:underline-offset-2"},{default:R(()=>{var m;return[P(g((m=t.user)==null?void 0:m.name),1)]}),_:2},1032,["to"]),e("div",Ke,[e("div",Oe,[e("time",null,g(r(O)(t.createdAt)),1),t.updatedAt!==t.createdAt&&t.updatedAt?(s(),u("span",{key:0,class:"ml-1",title:r(O)(t.updatedAt)}," ( 已編輯 ) ",8,Ne)):x("",!0)]),e("span",We,g(t.type==="friend"?"group":"public"),1)])])]),r(a).user.id===t.user._id?(s(),u("div",Ge,[e("button",{type:"button",onClick:m=>$(t._id),class:L(["material-symbols-outlined text-primary opacity-70 hover:opacity-100",{"opacity-100":k.value===t._id}])}," more_horiz ",10,He),e("ul",{class:L(["absolute right-0 top-8 z-10 w-32 text-center transition-all after:absolute after:-bottom-2 after:-right-2 after:left-2 after:top-2 after:-z-10 after:border-2 after:border-primary after:bg-white",{"pointer-events-none opacity-0 ":k.value!==t._id}])},[e("li",null,[e("button",{type:"button",onClick:m=>{$(),r(l).goToEditPost(t)},class:"flex w-full items-center gap-2 border-x-2 border-t-2 border-primary bg-white px-3 py-2 hover:bg-gray-100"},[Qe,P(" 編輯 ")],8,Je)]),e("li",null,[e("button",{type:"button",onClick:m=>{$(),b(t._id)},class:"flex w-full items-center gap-2 border-2 border-primary bg-white px-3 py-2 hover:bg-gray-100"},[Ye,P(" 刪除 ")],8,Xe)])],2)])):x("",!0)]),e("p",Ze,g(t.content),1),t.tags.length?(s(),u("ul",et,[(s(!0),u(E,null,D(t.tags,(m,v)=>(s(),u("li",{key:`${m}${v}`,class:"flex items-center"},[tt,P(" "+g(m),1)]))),128))])):x("",!0),t.image?(s(),u("img",{key:1,src:t.image,alt:"貼文圖片",class:"mt-4 max-w-full rounded-lg border-2 border-primary object-contain"},null,8,ot)):x("",!0)]),e("div",st,[e("button",{type:"button",onClick:m=>f(t.isLiked,t._id),disabled:i.value===t._id,class:L(["-ml-2 flex items-center gap-2 rounded-lg px-2 py-1 hover:bg-gray-100",t.likes?"text-secondary":"text-[#9B9893] hover:text-secondary"])},[e("span",{class:"material-symbols-outlined mt-[2px] text-xl",style:H(t.isLiked?"font-variation-settings: 'FILL' 1;":"")}," thumb_up ",4),e("span",null,g(t.likes?t.likes:"成為第一個按讚的朋友"),1),i.value===t._id?(s(),V(J,{key:0,width:"16px",height:"16px",color:"secondary"})):x("",!0)],10,nt),e("button",{type:"button",class:"flex items-center gap-2 rounded-lg px-2 py-1 hover:bg-gray-100",onClick:m=>o(t._id,d)},[lt,e("span",null,g(t.comments.length),1),e("span",{class:L(["material-symbols-outlined select-none transition-all duration-300",{"rotate-180":c.value[t._id]}])}," expand_more ",2)],8,rt)]),c.value[t._id]?(s(),V(Fe,{key:0,post:t,postIndex:d},null,8,["post","postIndex"])):x("",!0)]))),128)):(s(),u("div",at,[e("div",it,[(s(),u(E,null,D(["#DE4B63","#FAA722","#83C51D"],t=>e("span",{key:t,class:"select-none rounded-full border",style:H(`background-color: ${t}; border-color: #707070; height: 10px; width: 10px;`)},null,4)),64))]),e("div",dt,[r(l).keyword===""?(s(),u("p",ut," 目前尚無動態，新增一則貼文吧！ ")):(s(),u(E,{key:1},[ct,e("div",pt,[B(q,{to:`${r(n).path}`,class:"mx-auto flex items-center gap-1 text-secondary hover:opacity-80"},{default:R(()=>[mt,yt]),_:1},8,["to"])])],64))])])),r(n).params.postId?(s(),u("div",bt,[B(q,{to:(M=r(Y).fullPath)!=null&&M.match("/post/edit")?"/":r(Y).fullPath,class:"flex items-center gap-1 rounded-lg border-2 border-primary bg-secondary px-3 py-2 text-sm text-white hover:bg-goldenrod hover:text-primary",style:{"box-shadow":"0px 2px 0px #000400"}},{default:R(()=>[_t,P(" 返回 ")]),_:1},8,["to"])])):x("",!0)],64)}}},vt={class:"relative mb-5 flex rounded-lg border-2 border-primary bg-white after:absolute after:-bottom-2 after:-left-2 after:right-0 after:top-1 after:-z-10 after:rounded-lg after:border-2 after:border-primary after:bg-white"},ht=["src"],xt={class:"flex w-full items-center justify-between p-4"},gt={class:"font-bold"},wt={__name:"UserPostWallInfo",setup(w){const n=z(),a=X(),l=h(!1);async function y(){var c,o;let i=`https://node-training-2024.onrender.com/user/${n.user._id}`;i+=n.user.isFollowed?"/unfollow":"/follow";const f=n.user.isFollowed?"delete":"post";l.value=!0;try{await j[f](i),await n.getPosts()}catch(b){T({icon:"error",title:((o=(c=b.response)==null?void 0:c.data)==null?void 0:o.message)||b.message})}l.value=!1}return(i,f)=>{var o,b,k,$,S,_,C;const c=K("VueLoading");return s(),u(E,null,[B(c,{active:l.value,"onUpdate:active":f[0]||(f[0]=I=>l.value=I)},null,8,["active"]),e("div",vt,[e("img",{src:(o=r(n).user)==null?void 0:o.photo,alt:"大頭貼",class:"h-20 w-20 rounded-s-lg border-r-2 border-primary"},null,8,ht),e("div",xt,[e("div",null,[e("h2",gt,g((b=r(n).user)==null?void 0:b.name),1),e("p",null,g((k=r(n).user)==null?void 0:k.followers)+" 人追蹤",1)]),(($=r(n).user)==null?void 0:$._id)!==((S=r(a).user)==null?void 0:S.id)?(s(),u("button",{key:0,type:"button",onClick:y,class:"rounded-lg border-2 border-primary bg-goldenrod px-8 py-1 font-bold",style:H([(_=r(n).user)!=null&&_.isFollowed?"background-color:#EFECE7":"",{"box-shadow":"0px 2px 0px #000400"}])},g((C=r(n).user)!=null&&C.isFollowed?"取消追蹤":"追蹤"),5)):x("",!0)])])],64)}}},Et={__name:"PostWall",setup(w){const n=ee(),a=z(),l=h(!1),y=h(!1);async function i(){y.value=n.fullPath.match("/user/"),y.value?(a.postsOption="user",a.postsUserId=n.params.userId):a.postsOption="",a.keyword=n.query.q?n.query.q:"",a.sort=n.query.sort?n.query.sort:"desc",l.value=!0;const{postId:f}=n.params;f?await a.getPost(f):await a.getPosts(),l.value=!1}return N(async()=>{i()}),ne(()=>n,()=>{i()},{deep:!0}),(f,c)=>{const o=K("VueLoading");return s(),u(E,null,[B(o,{active:l.value,"onUpdate:active":c[0]||(c[0]=b=>l.value=b)},null,8,["active"]),y.value?(s(),V(wt,{key:0})):x("",!0),r(n).params.postId?x("",!0):(s(),V(pe,{key:1})),l.value?x("",!0):(s(),V(ft,{key:2}))],64)}}};export{Et as default};
